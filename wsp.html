<!DOCTYPE html>

<html>
    <head>
        <title>Test WSP Node.js</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="http://www.wsprice.it:8673/socket.io/socket.io.js"></script>
        <script src="http://www.wsprice.it/bundles/metronicadmin/plugins/jquery-1.10.2.min.js" type="text/javascript"></script>
        <script src="http://www.wsprice.it/bundles/metronicadmin/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>   
        <!-- 
        <script type="text/javascript" src="http://localhost:8673/socket.io/socket.io.js"></script>
        <script src="http://worldstickerprice.com/bundles/metronicadmin/plugins/jquery-1.10.2.min.js" type="text/javascript"></script>
        <script src="http://worldstickerprice.com/bundles/metronicadmin/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>   
        -->

        <script type="text/javascript">
            var socket = io.connect('http://www.wsprice.it:8673');
//            var socket = io.connect('http://localhost:8673');
            var user = Math.round(Math.random()*9999);
                
            var $dom = null;
    
            function emit(id) {
                log(id, 'emit', array2object($('#'+id).serializeArray()));
                socket.emit(id, array2object($('#'+id).serializeArray()));
            }
            
            function array2object(array) {
                var object = {};
                $.map(array, function(n, i) {
                    object[n['name']] = n['value'];
                });
                return object;
            }
            
            function log(action, mode, data) {
                $tr = $('<tr></tr>');
                now = new Date();
                $tr.append('<td nowrap>'+now.getHours()+':'+now.getMinutes()+':'+now.getSeconds()+' '+now.getMilliseconds()+'</td>');
                $tr.append('<td>'+action+'</td>');
                $tr.append('<td>'+mode+'</td>');
                $tr.append('<td>'+JSON.stringify(data)+'</td>');
                $('#log').prepend($tr);
            }
            
            socket.on('login', function(response) {
                log('login', 'on', response);
            });   
            
            socket.on('getNegozi', function(response) {
                log('getNegozi', 'on', response);
            });   
            
            socket.on('setDescrizioneNegozio', function(response) {
                log('setDescrizioneNegozio', 'on', response);
            });   
            
            $(document).ready(function(){
                $('#emit').change(function(){
                    $('.emit').hide();
                    $('#tr_'+$(this).val()).show();
                });
            });
        </script>
    </head>
    <body>
        <table>
            <thead>
                <tr>
                    <th>Test</th>
                    <th>LOG</th>
                </tr>
            </thead>
            <tbody>
                <tr valign="top">
                    <td>
                        <select id="emit">
                            <option value="login">Login</option>
                            <option value="getNegozi">Get Negozi</option>
                            <option value="setDescrizioneNegozio">Set Descrizione Negozio</option>
                        </select>
                        <table border="1">
                            <thead>
                                <tr>
                                    <th>Action</th>
                                    <th>Form</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="tr_login" class="emit">
                                    <th>login</th>
                                    <td>
                                        <form class="socket" id="login" onsubmit="return false">
                                            <div>
                                                <label>Username</label><br/>
                                                <input type="text" name="_username">
                                            </div>
                                            <div>
                                                <label>Password</label><br/>
                                                <input type="text" name="_password">
                                            </div>
                                            <button onclick="emit('login')">LOGIN</button>
                                        </form>
                                    </td>
                                </tr>
                                <tr id="tr_getNegozi" class="emit" style="display: none;">
                                    <th>getNegozi</th>
                                    <td>
                                        <form class="socket" id="getNegozi" onsubmit="return false">
                                            <div>
                                                <label>Token</label><br/>
                                                <input type="text" name="token">
                                            </div>
                                            <button onclick="emit('getNegozi')">GET NEGOZI</button>
                                        </form>
                                    </td>
                                </tr>
                                <tr id="tr_setDescrizioneNegozio" class="emit" style="display: none;">
                                    <th>getNegozi</th>
                                    <td>
                                        <form class="socket" id="setDescrizioneNegozio" onsubmit="return false">
                                            <div>
                                                <label>Token</label><br/>
                                                <input type="text" name="token">
                                            </div>
                                            <div>
                                                <label>Negozio</label><br/>
                                                <input type="text" name="id">
                                            </div>
                                            <div>
                                                <label>Descrizione</label><br/>
                                                <textarea name="descrizione"></textarea>
                                            </div>
                                            <button onclick="emit('setDescrizioneNegozio')">SET DESCRIZIONE NEGOZIO</button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                    <td>
                        <table border="1">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Action</th>
                                    <th>Function</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody id="log">
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>
    </body>
</html>
